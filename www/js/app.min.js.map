{"version":3,"sources":["app.js","app.dev.js","controllers.js","db-firebase.js","db-firebase.old.js","directives.js","filters.js","services.js"],"names":["angular","module","config","$stateProvider","$urlRouterProvider","state","url","abstract","templateUrl","views","mainContent","run","$ionicPlatform","ready","window","cordova","plugins","Keyboard","hideKeyboardAccessoryBar","StatusBar","styleDefault","controller","onEnter","logout","otherwise","c","console","log","$scope","db","$rootScope","$state","login","user","signup","auth","createUser","then","userId","firstName","lastName","email","create","error","bindPending","password","code","resumeSession","update","mapCreated","map","$stateParams","getUserData","getUserDinners","dinners","util","dinner","isPublic","hostedByUser","data","go","fromNow","takeawayFrom","now","takeawayUntil","getDinnersSync","getBeginTime","time","dinein","enabled","takeaway","from","application","count","getDinnerSync","dinnerId","applications","getDinnerApplicationsSync","addCount","min","max","newCount","apply","uid","$id","newApplication","applicationState","forEach","isHost","acceptApplication","a","updateApplicationState","declineApplication","value","Firebase","factory","$q","$firebase","fb","checkObject","obj","properties","settings","checkArguments","undefined","Error","Array","isArray","prototype","slice","call","arguments","p","createError","name","message","ref","root","getRefURL","toString","unauthorized","notFound","query","set","resolve","reject","push","newRef","key","get","once","dataSnapshot","val","credentials","authWithPassword","session","onAuth","offAuth","unauth","getCurrentSession","getAuth","child","notification","_","cloneDeep","createdAt","ServerValue","TIMESTAMP","updatedAt","updateSettings","createImage","deleteImage","reorderImage","getFriends","getNotifications","orderByChild","equalTo","friendRequest","send","byUser","toUser","status","accept","friendRequestId","getIncoming","getOutgoing","review","orderByKey","getMessages","getReviews","createMessage","text","close","closedAt","cancel","cancelledAt","applicationId","rejectApplication","createApplication","createReview","aboutDinner","aboutUser","toDinner","toGroup","forUser","type","markAsRead","notificationId","openedAt","d","defer","userData","firstname","lastname","promise","currentSession","getUserSync","$asObject","updateUserData","newDinner","sync","$asArray","$loaded","startAt","endAt","getUserApplicationsSync","aId","$save","directive","restrict","scope","onCreate","link","$element","$attr","initialize","mapOptions","center","google","maps","LatLng","zoom","mapTypeId","MapTypeId","ROADMAP","streetViewControl","Map","event","addDomListener","e","preventDefault","document","readyState","element","attr","dot","className","showClassName","html","append","$watch","pendingDots","newVal","addClass","removeClass","f","filter","s","friends","id","all","friendId","offsetMins","n","Date","getTime","getTimezoneOffset","done"],"mappings":"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","file":"app.min.js","sourcesContent":["// angular.module is a global place for creating, registering and retrieving Angular modules\n// 'starter' is the name of this angular module example (also set in a <body> attribute in index.html)\n// the 2nd parameter is an array of 'requires'\n// 'starter.services' is found in services.js\n// 'starter.controllers' is found in controllers.js\n\nangular.module('dc', ['ionic', 'dc.controllers', 'dc.services', 'dc.filters', 'dc.db', 'dc.directives', 'dc.dev'])\n\n.run(function($ionicPlatform) {\n   $ionicPlatform.ready(function() {\n      // Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n      // for form inputs)\n      if (window.cordova && window.cordova.plugins.Keyboard) {\n         cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);\n      }\n      if (window.StatusBar) {\n         // org.apache.cordova.statusbar required\n         StatusBar.styleDefault();\n      }\n   });\n})\n\n.config(function($stateProvider, $urlRouterProvider) {\n\n   // Ionic uses AngularUI Router which uses the concept of states\n   // Learn more here: https://github.com/angular-ui/ui-router\n   // Set up the various states which the app can be in.\n   // Each state's controller can be found in controllers.js\n   $stateProvider\n\n   .state('login', {\n      url: '/login',\n      templateUrl: 'templates/login.html',\n      controller: 'LoginCtrl'\n   })\n\n   .state('logout', {\n      url: '/logout',\n      onEnter: function(logout) {\n         logout();\n      }\n   })\n\n   .state('signup', {\n      url: '/signup',\n      templateUrl: 'templates/signup.html',\n      controller: 'SignupCtrl'\n   })\n\n\n   .state('app', {\n      url: '/app',\n      abstract: true,\n      templateUrl: 'templates/menu.html',\n      controller: 'AppCtrl'\n   })\n\n   .state('app.settings', {\n      url: '/settings',\n      views: {\n         'mainContent': {\n            templateUrl: 'templates/settings.html',\n            controller: 'SettingsCtrl'\n         }\n      }\n   })\n\n   .state('app.newdinner', {\n      url: \"/newdinner\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/newdinner.html\",\n            controller: \"NewDinnerCtrl\"\n         }\n      }\n   })\n\n   .state('app.lookfor', {\n      url: \"/lookfor\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/lookfor.html\",\n            // controller: 'LookForDinnersCtrl' // FIXME\n         }\n      }\n   })\n\n   .state('app.user', {\n      url: \"/user/:userId\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/profile.html\",\n            // controller: 'UserCtrl'\n         }\n      }\n   })\n\n\n   .state('app.dinner', {\n      url: \"/dinner/:dinnerId\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/dinner.html\",\n            // controller: 'DinnerCtrl'\n         }\n      }\n   })\n\n\n   // if none of the above states are matched, use this as the fallback\n   $urlRouterProvider.otherwise('/login');\n});\n","\nangular.module( 'dc.dev', [] )\n\n.config(function($stateProvider, $urlRouterProvider) {\n   $stateProvider\n\n   .state('dev', {\n      url: '/dev',\n      abstract: true,\n      templateUrl: 'templates/menu.html',\n   })\n\n   .state('dev.menu', {\n      url: \"/menu\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/developer.html\"\n         }\n      }\n   })\n\n   .state('dev.login', {\n      url: \"/login\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/login.html\"\n         }\n      }\n   })\n\n   .state('dev.signup', {\n      url: \"/signup\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/signup.html\"\n         }\n      }\n   })\n\n   .state('dev.newdinner', {\n      url: \"/newdinner\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/newdinner.html\"\n         }\n      }\n   })\n\n   .state('dev.lookfor', {\n      url: \"/lookfor\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/lookfor.html\"\n         }\n      }\n   })\n\n   .state('dev.lookfor_filter', {\n      url: \"/lookfor_filter\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/lookfor_filter.html\"\n         }\n      }\n   })\n\n   .state('dev.profile', {\n      url: \"/profile\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/profile.html\"\n         }\n      }\n   })\n\n   .state('dev.dinner', {\n      url: \"/dinner\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/dinner.html\"\n         }\n      }\n   })\n\n   .state('dev.settings', {\n      url: \"/settings\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/settings.html\"\n         }\n      }\n   })\n\n   .state('dev.notifications', {\n      url: \"/notifications\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/notifications.html\"\n         }\n      }\n   })\n\n   .state('dev.dinner_list', {\n      url: \"/dinner_list\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/dinner_list.html\"\n         }\n      }\n   })\n\n   .state('dev.person_list', {\n      url: \"/person_list\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/person_list.html\"\n         }\n      }\n   })\n\n   .state('dev.person_list_interactive', {\n      url: \"/person_list_interactive\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/person_list_interactive.html\"\n         }\n      }\n   })\n\n   .state('dev.confirm_application', {\n      url: \"/confirm_application\",\n      views: {\n         'mainContent': {\n            templateUrl: \"templates/confirm_application.html\"\n         }\n      }\n   })\n\n});\n","var c = angular.module( 'dc.controllers', ['dc.services'] );\n\n\n// c.controller('AppCtrl', function($scope, $ionicModal, $timeout) {\nc.controller('AppCtrl', function() {\n\tconsole.log('Controller: app');\n});\n\n\n/**\n * Sign up\n */\nc.controller('SignupCtrl', function($scope, db, $rootScope, $state, login) {\n\tconsole.log('Controller: signup');\n\t$scope.user = {};\n\n\t$scope.signup = function() {\n\t\tconsole.log('signing up', $scope.user);\n\t\tvar user;\n\t\tdb.auth.createUser($scope.user)\n\t\t.then(function(userId) {\n\t\t\tuser = {\n\t\t\t\tuserId: userId,\n\t\t\t\tfirstName: $scope.user.firstName,\n\t\t\t\tlastName: $scope.user.lastName,\n\t\t\t\temail: $scope.user.email\n\t\t\t};\n\t\t\treturn db.user.create(user);\n\t\t}).then(function() {\n\t\t\tconsole.log('signup successful');\n\t\t\tlogin($scope.user);\n\t\t}).catch(function (error) {\n\t\t\tconsole.error('error signing up', error);\n\t\t});\n\t};\n});\n\n\n/**\n * Log in\n */\nc.controller('LoginCtrl', function($scope, login, bindPending) {\n\tconsole.log('Controller: login');\n\n\t$scope.user = {};\n\t$scope.user = {\n\t\t'email': 'jd@example.com',\n\t\t'password': 'asdf'\n\t};\n\n\t$scope.login = function() {\n\t\tbindPending( login($scope.user), $scope )\n\t\t.catch(function(error) {\n\t\t\t$scope.error = error.code;\n\t\t\tthrow error;\n\t\t});\n\t};\n});\n\n\n/**\n * Settings\n */\nc.controller('SettingsCtrl', function($scope, db, $rootScope, $state, resumeSession) {\n\tconsole.log('Controller: settings');\n\tresumeSession($scope);\n\n\t$scope.update = function() {\n\t\tconsole.log('updating user');\n\t\tdb.user.update($scope.user).then(function() {\n\t\t\tconsole.log('update successful');\n\t\t}, function(error) {\n\t\t\tconsole.error('update failed', error);\n\t\t});\n\t};\n\n\t$scope.mapCreated = function(map) {\n\t\t$scope.map = map;\n\t};\n});\n\n\n/* User Profile */\nc.controller('UserCtrl', function($scope, db, resumeSession, $stateParams) {\n\tresumeSession($scope);\n\tdb.getUserData($stateParams.userId).then(function(user) {\n\t\t$scope.user = user;\n\t});\n\n\tdb.getUserDinners($stateParams.userId).then(function(dinners) {\n\t\t$scope.dinners = dinners;\n\t});\n});\n\n\n/* New Dinner */\nc.controller('NewDinnerCtrl', function($scope, db, $rootScope, $state, resumeSession, util) {\n\tconsole.log('Controller: newdinner');\n\tresumeSession($scope);\n\n\t$scope.dinner = {\n\t\tisPublic: true\n\t};\n\n\tif ($scope.user) $scope.dinner.hostedByUser = $scope.user.userId;\n\n\t$scope.create = function() {\n\t\tdb.dinner.create($scope.dinner).then(function(data) {\n\t\t\tconsole.log('Dinner created', $scope.dinner);\n\t\t\t$state.go('app.lookfor');\n\t\t}, function(error) {\n\t\t\tconsole.error('Error creating dinner', error);\n\t\t});\n\t};\n\n\t$scope.fromNow = function() {\n\t\t$scope.dinner.takeawayFrom = util.now();\n\t\t$scope.dinner.takeawayUntil = util.now(60);\n\t};\n});\n\n\n/* Look for  Dinner */\nc.controller('LookForDinnersCtrl', function($scope, db, resumeSession) {\n\tconsole.log('Controller: lookfor');\n\tresumeSession($scope);\n\t$scope.dinners = db.getDinnersSync();\n\t//console.log('dinners', $scope.dinners);\n\n\t// TODO: remove this. use filter instea\n\t$scope.getBeginTime = function(dinner) {\n\t\tvar time;\n\t\tif (dinner.dinein && dinner.dinein.enabled) time = dinner.dinein.time;\n\t\telse if (dinner.takeaway && dinner.takeaway.enabled) time = dinner.takeaway.from;\n\t\treturn time;\n\t};\n});\n\n\n/* Dinner */\nc.controller('DinnerCtrl', function($scope, db, resumeSession, $stateParams, $state) {\n\tresumeSession($scope);\n\n\t$scope.application = { count:1 };\n\t$scope.dinner = db.getDinnerSync($stateParams.dinnerId);\n\t$scope.applications = db.getDinnerApplicationsSync($stateParams.dinnerId);\n\n\t$scope.addCount = function(count, min, max) {\n\t\tvar newCount = $scope.application.count += count;\n\t\tif (newCount < min) newCount = min;\n\t\telse if (newCount > max) newCount = max;\n\t\t$scope.application.count = newCount;\n\t};\n\n\t$scope.apply = function(dinein) {\n\t\tif (dinein) $scope.application.dinein = true;\n\t\telse $scope.application.dinein = false;\n\t\t$scope.application.userId = $scope.user.uid;\n\t\t$scope.application.dinnerId = $scope.dinner.$id;\n\t\tdb.newApplication($scope.application).then(function(application) {\n\t\t\tconsole.log('application created:', application)\n\t\t\t// $state.go('app.dinner', {dinnerId: application.dinnerId});\n\t\t}, function(error) {\n\t\t\tconsole.log('error creating application:', error);\n\t\t});\n\t};\n\n\t$scope.applicationState = function() {\n\t\tvar state = \"\";\n\t\tangular.forEach($scope.applications, function(application) {\n\t\t\tif (application.userId === $scope.user.uid) {\n\t\t\t\t//console.log(application);\n\t\t\t\tstate = application.state;\n\t\t\t\t$scope.application = application;\n\t\t\t}\n\t\t});\n\t\treturn state;\n\t};\n\n\t$scope.isHost = function() {\n\t\treturn ($scope.user && $scope.dinner.user === $scope.user.uid);\n\t};\n\n\t$scope.acceptApplication = function(a) {\n\t\ta.state = 'accepted';\n\t\tdb.updateApplicationState(a.$id, 'accepted').then(function() {\n\t\t\tconsole.log('application accepted');\n\t\t}, function(error) {\n\t\t\tconsole.error('error accepting application', error);\n\t\t});\n\t};\n\t$scope.declineApplication = function(a) {\n\t\ta.state = 'declined';\n\t\tdb.updateApplicationState(a.$id, 'declined').then(function() {\n\t\t\tconsole.log('application declined');\n\t\t}, function(error) {\n\t\t\tconsole.error('error declining application', error);\n\t\t});\n\t};\n});\n","angular.module('dc.db', ['firebase'])\n\n.value( 'fb', new Firebase(\"https://dinner-collective.firebaseio.com/\") ) // define firebase ref as value service so it can be overridden easily\n\n.factory('db', ['$rootScope', '$q', '$firebase', 'fb' , function($rootScope, $q, $firebase, fb) {\n\n\tvar ref = { root: fb }; // store firebase references. place the main ref in there as 'root' as well, even though is shorter just to use 'fb'\n\n\tvar db = {}; // the db interface to be exported (as 'db')\n\tdb.ref = ref; // make refs available for testing\n\tdb.settings = {};\n\tdb.settings.checkArguments = false; // set true to check arguments using the checkObject function\n\n\tdb.util = {};\n\t/**\n\t * Get current firebase URL. Used for testing.\n\t * @return {String} - URL of the firebase reference currently in use.\n\t */\n\tdb.util.getRefURL = function() {\n\t\treturn fb.toString();\n\t};\n\n\t// check that an object is defined and optionally has some defined properties\n\t// properties can be given as array of strings or as separate string arguments\n\tfunction checkObject (obj, properties) {\n\t\tif ( ! db.settings.checkArguments ) return true;\n\t\t// check obj itself\n\t\tif ( typeof obj != 'object' || obj == undefined ) {\n\t\t\tthrow new Error(obj + ' is expected to be an object.');\n\t\t}\n\t\t// if properties is not given or is not an array, create the properties array from arguments\n\t\tif ( properties == undefined || !Array.isArray(properties) ) { // == undefined tests for null and undefined\n\t\t\tproperties = Array.prototype.slice.call(arguments, 1);\n\t\t}\n\t\t// check properties\n\t\tproperties.forEach( function checkProperties (p) {\n\t\t\tif ( obj[p] === undefined ) {\n\t\t\t\tthrow new Error(obj.p + ' is expected to be defined.');\n\t\t\t}\n\t\t});\n\t\treturn true;\n\t};\n\tdb.util.checkObject = checkObject; // make it available for testing\n\n\t// TODO: complete\n\t// function checkObjectAlt(obj, propLists) {\n\t// \tif ( ! db.settings.checkArguments ) return true;\n\t// \t// check obj itself\n\t// \tif ( typeof obj != 'object' || obj == undefined ) {\n\t// \t\tthrow new Error(obj + ' is expected to be an object.');\n\t// \t}\n\t//\n\t// }\n\n\n\tfunction createError (name, message) {\n\t\tvar error = new Error(message);\n\t\terror.name = name;\n\t\treturn error\n\t};\n\tdb.util.createError = createError;\n\n\tdb.error = {\n\t\tunauthorized : 'UNAUTHORIZED',\n\t\tnotFound : 'NOT_FOUND'\n\t};\n\n/*\n * queries can be grouped due to different criteria:\n * technical type (create, update, delete)\n * by context (the view where they might be used)\n * by the data they operate on (type created or returned)\n *\n * general API considerations\n */\n\n\n/**\n * TODO: return defined errors\n * TODO: move errors and util functions to a seperat file\n * TODO: firebase query helpers: push obj + return id, update object, get by id, get by child\n *\n */\n\n\n/**\n * @callback successCallback\n * @param result - The result.\n */\n\n/**\n * @callback errorCallback\n * @param reason - The rejection reason.\n */\n\n/**\n * @callback callback\n */\n\n/**\n * Calls one of the success or error callbacks asynchronously as soon as the result is available.\n * @typedef {function} thenFunction\n * @param {successCallback}\n * @param {errorCallback}\n * @returns {Promise} - This promise is fulfilled with the return value of either callback. It is rejected with the error if either callback throws an exception.\n */\n\n/**\n * Sugar for Promise.then(undefined, errorCallback)\n * @typedef {function} catchFunction\n * @param {errorCallback}\n * @returns {Promise} - This promise is fulfilled with the return value of the error callback.\n */\n\n/**\n * Calls the callback as soon as the promise is either fulfilled or rejected. Useful for cleanup.\n * @typedef {function} finallyFunction\n * @param {callback}\n */\n\n/**\n * Angular Promise. Usually from the $q service.\n * @typedef {Object} Promise\n * @property {thenFunction} then\n * @property {catchFunction} catch\n * @property {finallyFunction} finally\n */\n\n\n/*\n * generic firebase query functions\n * using angular promises\n */\ndb.query = {};\n\ndb.query.set = function set (ref, data) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tref.set(data, function onComplete (error) {\n\t\t\tif (error === null) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t});\n};\n\ndb.query.push = function push (ref, data) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tvar newRef = ref.push(data, function onComplete (error) {\n\t\t\tif (error === null) {\n\t\t\t\tresolve(newRef.key());\n\t\t\t} else {\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t});\n};\n\ndb.query.update = function update (ref, data) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tref.update(data, function onComplete (error) {\n\t\t\tif (error === null) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t});\n};\n\ndb.query.get = function get (ref) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tref.once('value', function callback (dataSnapshot) {\n\t\t\tvar data = dataSnapshot.val();\n\t\t\tif (data === null) {\n\t\t\t\treject( createError(db.error.notFound, 'db.query.get: no data.') );\n\t\t\t} else {\n\t\t\t\tresolve(data);\n\t\t\t}\n\t\t}, function cancelCallback (error) {\n\t\t\treject( createError(db.error.unauthorized, error.message) );\n\t\t});\n\t});\n};\n\n/*\n * AUTHENTICATION\n *\n * login user\n * logout user\n * current session\n *\n */\n\n/**\n * @typedef {Object} UserCredentials\n * @property {string} email\n * @property {string} password\n */\n\ndb.auth = {};\n/**\n * Create a new user\n * @param {Object} user\n * email, password\n * @return {Promise} - user id on success. Error message on error.\n */\ndb.auth.createUser = function (credentials) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tfb.createUser(credentials, function onComplete (error, user) {\n\t\t\tif (error === null) {\n\t\t\t\tresolve(user.uid);\n\t\t\t} else {\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t});\n};\n\n/**\n * Login a user with email and password.\n * @param {UserCredentials} credentials\n * email, password\n * @return {Promise} - user id on success. error object on error.\n */\ndb.auth.login = function (credentials) {\n\treturn $q(function resolver (resolve, reject) {\n\t  fb.authWithPassword(credentials, function onComplete (error, session) {\n\t    if (error === null) {\n\t    \tresolve(session.uid, session);\n\t    } else {\n\t    \treject(error);\n\t    }\n\t  });\n\t});\n};\n\ndb.auth.logout = function () {\n\treturn $q(function resolver (resolve, reject) {\n\t\tfb.onAuth(function onAuth (session) {\n\t\t\tif (session === null) {\n\t\t\t\tfb.offAuth(onAuth);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t\tfb.unauth();\n\t});\n};\n\n/**\n * [getCurrentSession description]\n * @return {Promise} - user id on success.\n */\ndb.auth.getCurrentSession = function () {\n\treturn $q(function resolver (resolve, reject) {\n\t\tvar session = fb.getAuth(); // sync\n\t\t// console.log('current session:', session);\n\t\tif (session === null) {\n\t\t\t// console.log('rejecting');\n\t\t\treject();\n\t\t} else {\n\t\t\t// console.log('resolving');\n\t\t\tresolve(session.uid);\n\t\t}\n\t});\n};\n\n\n/*\n * USER\n *\n * new user (C)\n * change settings (U)\n * add photo (C)\n * remove photo (D)\n * reorder photo (U)\n *\n *\n *\n * friends of this user\n * user data incl. settings\n * gallery pictures\n *\n *\n * dinners hosted by this user\n * dinners the user applied to/was accepted to/was rejected from (mutually excl.)\n * dinners invited to\n *\n * groups with member status\n * groups with admin status\n * notifications received\n * reviews of dinners hosted by this user\n *\n */\n\n\nref.user = fb.child('user');\nref.notification = fb.child('notification');\ndb.user = {};\n\n/*\n\tcreate a user record\n\tuser needs to have userId (obtained from auth.createUser and auth.login)\n\tother fields are optional, the ones that are present are updated\n */\ndb.user.create = function (user) {\n\tuser = _.cloneDeep(user); // don't modify the passed data\n\treturn $q(function (resolve, reject) {\n\t\tcheckObject(user, 'userId', 'firstName', 'lastName', 'email');\n\t\tuser.createdAt = Firebase.ServerValue.TIMESTAMP;\n\t\tref.user.child(user.userId).set(user, function onComplete(error) {\n\t\t\tif (error === null) resolve();\n\t\t\telse reject(error);\n\t\t});\n\t});\n};\n\n/*\n\tupdate user data\n\tuser needs to have userId\n\tother fields are optional, the ones that are present are updated\n */\ndb.user.update = function (user) {\n\tuser = _.cloneDeep(user); // don't modify the passed data\n\n\treturn $q(function (resolve, reject) {\n\t\tcheckObject(user, 'userId');\n\t\tuser.updatedAt = Firebase.ServerValue.TIMESTAMP;\n\t\tref.user.child(user.userId).update(user, function onComplete(error) {\n\t\t\tif (error === null) resolve();\n\t\t\telse reject(error);\n\t\t});\n\t});\n};\n\ndb.user.updateSettings = function (userId, settings) {\n\treturn db.query.update( ref.user.child(userId).child('settings'), settings );\n};\n\ndb.user.createImage = function () {\n\n};\n\ndb.user.deleteImage = function () {\n\n};\n\ndb.user.reorderImage = function () {\n\n};\n\ndb.user.getFriends = function (userId) {\n\treturn db.query.get( ref.user.child(userId).child('friends') );\n};\n\n// user data incl. settings and pics\ndb.user.get = function (userId) {\n\treturn db.query.get( ref.user.child(userId) );\n};\n\ndb.user.getNotifications = function (userId) {\n\treturn db.query.get(\n\t\tref.notification.orderByChild('forUser').equalTo(userId)\n\t);\n};\n\n\n/*\n * FRIEND REQUESTS\n *\n * send friend request (U)\n * accept friend request (U)\n * friend requests received\n *\n */\ndb.friendRequest = {};\nref.friendRequest = fb.child('friendRequest');\n\n// TODO: test\n// TODO: check that users exist\ndb.friendRequest.send = function (byUser, toUser) {\n\t// TODO: check values\n\tvar friendRequest = {\n\t\tcreatedAt : Firebase.ServerValue.TIMESTAMP,\n\t\tbyUser : byUser,\n\t\ttoUser : toUser,\n\t\tstatus : 'pending'\n\t};\n\treturn db.query.push( ref.friendRequest, friendRequest );\n};\n\n// TODO: test\n// TODO: only if toUser is sending the request\ndb.friendRequest.accept = function (friendRequestId) {\n\tvar friendRequest = {\n\t\tupdatedAt : Firebase.ServerValue.TIMESTAMP,\n\t\tstatus : 'accepted'\n\t};\n\treturn db.query.update(\n\t\tref.friendRequest.child(friendRequestId),\n\t\tfriendRequest\n\t);\n};\n\n// TODO: test\n// TODO: only if toUser is sending the request\ndb.friendRequest.reject = function (friendRequestId) {\n\tvar friendRequest = {\n\t\tupdatedAt : Firebase.ServerValue.TIMESTAMP,\n\t\tstatus : 'rejected'\n\t};\n\treturn db.query.update(\n\t\tref.friendRequest.child(friendRequestId),\n\t\tfriendRequest\n\t);\n};\n\n// TODO: test\n// TODO: only if userId is sending the request\ndb.friendRequest.getIncoming = function (userId) {\n\treturn db.query.get(\n\t\tref.friendRequest.orderByChild('toUser').equalTo(userId)\n\t);\n};\n\n// TODO: test\n// TODO: only if userId is sending the request\ndb.friendRequest.getOutgoing = function (userId) {\n\treturn db.query.get(\n\t\tref.friendRequest.orderByChild('fromUser').equalTo(userId)\n\t);\n};\n\n\n\n/*\n * DINNER (All)\n *\n *\n * basic info (title, description, address, time, ...)\n * users that applied/were accepted/were rejected (mutally excl.)\n * messages posted regarding this dinner\n * reviews of this dinner\n *\n */\n\ndb.dinner = {};\nref.dinner = fb.child('dinner');\nref.application = fb.child('application');\nref.message = fb.child('message');\nref.review = fb.child('review');\n\ndb.dinner.get = function (dinnerId) {\n\treturn db.query.get(\n\t\tref.dinner.orderByKey().equalTo(dinnerId)\n\t);\n};\n\ndb.dinner.getMessages = function (dinnerId) {\n\treturn db.query.get( ref.message.orderByChild('toDinner').equalTo(dinnerId) );\n};\n\ndb.dinner.getReviews = function (dinnerId) {\n\treturn db.query.get( ref.review.orderByChild('aboutDinner').equalTo(dinnerId) );\n};\n\ndb.dinner.createMessage = function (message) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tmessage = _.cloneDeep(message);\n\t\tcheckObject(message, createdAt, byUser, text);\n\t\tmessage.createdAt = Firebase.ServerValue.TIMESTAMP;\n\t\t// TODO: either toDinner or toGroup needs to be set.\n\t\tresolve( db.query.create(ref.message.push(message)) );\n\t});\n};\n\n\n/*\n * DINNER (Host)\n *\n * new dinner (C dinner)\n * close dinner (U dinner)\n * cancel dinner (U dinner)\n * x invite user (C invitation)\n * x invite group (C invitation)\n * accept/reject application (U applicaton)\n *\n * x users that are invited\n *\n */\n\n// create a new dinner\n// fulfills with the new dinnerId, rejects with the error\n// TODO: test\ndb.dinner.create = function (dinner) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tdinner = _.cloneDeep(dinner); // don't modify the passed data\n\t\tcheckObject(dinner, 'hostedByUser', 'title', 'description', 'tags', 'isPublic'); // can throw and thus reject this promise\n\t\t// TODO: check for dineinAt or (takeawayFrom and takeawayUntil)\n\t\tdinner.createdAt = Firebase.ServerValue.TIMESTAMP;\n\t\tresolve( db.query.push(ref.dinner, dinner) );\n\t});\n};\n\n// TODO: test\n// TODO: can't close if cancelled, only possible if host of dinner\ndb.dinner.close = function (dinnerId) {\n\tvar dinner = {\n\t\t// dinnerId : dinnerId,\n\t\tupdatedAt : Firebase.ServerValue.TIMESTAMP,\n\t\tclosedAt : Firebase.ServerValue.TIMESTAMP\n\t};\n\treturn db.query.update( ref.dinner.child(dinnerId), dinner );\n};\n\n// TODO: test\n// TODO: only possible if host of dinner\ndb.dinner.cancel = function (dinnerId) {\n\tvar dinner = {\n\t\t// dinnerId : dinnerId,\n\t\tupdatedAt : Firebase.ServerValue.TIMESTAMP,\n\t\tcancelledAt : Firebase.ServerValue.TIMESTAMP\n\t};\n\treturn db.query.update( ref.dinner.child(dinnerId), dinner );\n};\n\n// TODO: test\n// TODO: only possible if host of dinner\ndb.dinner.acceptApplication = function (applicationId) {\n\tvar application = {\n\t\tupdatedAt : Firebase.ServerValue.TIMESTAMP,\n\t\tstatus : 'accepted'\n\t};\n\treturn db.query.update( ref.application.child(applicationId), application );\n};\n\n// TODO: test\n// TODO: only possible if host of dinner\ndb.dinner.rejectApplication = function (applicationId) {\n\tvar application = {\n\t\tupdatedAt : Firebase.ServerValue.TIMESTAMP,\n\t\tstatus : 'rejected'\n\t};\n\treturn db.query.update( ref.application.child(applicationId), application );\n};\n\n\n/*\n * DINNER (Guest)\n *\n * apply (C application)\n * x accept invitation (U invitation)\n *\n */\n\n// TODO: test\ndb.dinner.createApplication = function (application) {\n\treturn $q(function(resolve, reject) {\n\t\tapplication = _.cloneDeep(application); // don't modify the passed data\n\t\tcheckObject(application, 'byUser', 'forDinner', 'numSpots', 'isDineIn', 'isPublic');\n\t\t// TODO: what about host property?\n\t\t// TODO: cant apply to own dinner, can't apply to closed or cancelled or past dinner.\n\t\tapplication.createdAt = Firebase.ServerValue.TIMESTAMP;\n\t\tapplication.status = 'pending';\n\t\tresolve(\n\t\t\tdb.query.push(ref.application, application)\n\t\t);\n\t});\n};\n\ndb.dinner.createReview = function (review) {\n\treturn $q(function resolver (resolve, reject) {\n\t\treview = _.cloneDeep(review);\n\t\tcheckObject(review, byUser, text, aboutDinner, aboutUser);\n\t\treview.createdAt = Firebase.ServerValue.TIMESTAMP;\n\t\t// TODO: either toDinner or toGroup needs to be set.\n\t\tresolve( db.query.push(ref.review, review) );\n\t});\n};\n\ndb.dinner.createMessage = function (message) {\n\treturn $q(function resolver (resolve, reject) {\n\t\tmessage = _.cloneDeep(message);\n\t\tcheckObject(message, byUser, text, toDinner);\n\t\tmessage.createdAt = Firebase.ServerValue.TIMESTAMP;\n\t\tdelete message.toGroup;\n\t\tresolve( db.query.push(ref.message, message) );\n\t});\n};\n\n\n/*\n * MESSAGE\n *\n * post message to dinner (C message)\n * post message to group (C message)\n *\n */\n// db.createDinnerMessage = function (message) {\n//\n// };\n//\n// db.createGroupMessage = function (message) {\n//\n// };\n\n\n/*\n * NOTIFICATION\n *\n * post notification (C notification)\n * mark as read (U notification)\n *\n */\n\ndb.notification = {};\n\ndb.notification.create = function (notification) {\n\treturn function resolver (resolve, reject) {\n\t\tnotification = _.cloneDeep(notification);\n\t\tcheckObject( notification, forUser, type, text, aboutUser );\n\t \tnotification = Firebase.ServerValue.TIMESTAMP;\n\t\t// TODO: either toDinner or toGroup needs to be set.\n\t\tresolve( db.query.create(ref.notification.push(message)) );\n\t}\n};\n\ndb.notification.markAsRead = function (notificationId) {\n\treturn function resolver (resolve, reject) {\n\t\tvar notification = {\n\t\t\topenedAt : Firebase.ServerValue.TIMESTAMP\n\t\t}\n\t\tresolve( db.query.update(notificationId, notification) );\n\t}\n};\n\n\n\n/*\n * REVIEW\n *\n * post review (C review)\n *\n */\n\ndb.createReview = function (review) {\n\treturn function resolver (resolve, reject) {\n\t\tcheckObject(review, byUser, text);\n\t\t// TODO: either aboutDinner or aboutUser needs to be set.\n\t\tresolve( db.query.push(ref.review, review) );\n\t}\n};\n\n\n/*\n * GROUP\n *\n * create new group (C group)\n * invite user to group (U user)\n * accept/reject group invitation (U group)\n * join group (U group)\n * leave group (U group)\n * add admin (U group)\n *\n * basic info (title, description, invite only status, ...)\n * admins\n * members\n * messages regarding this group\n *\n */\n// db.group = {};\n//\n// db.group.create = function (group) {\n//\n// };\n//\n// db.group.inviteUser = function (group) {\n//\n// };\n//\n// db.group.join = function (groupId) {\n//\n// };\n//\n// db.group.leave = function (groupId) {\n//\n// };\n//\n// db.group.get = function (group) {\n//\n// };\n//\n// db.group.getMembers = function (group) {\n//\n// };\n//\n// db.group.getAdmins = function (group) {\n//\n// };\n//\n// db.group.getMessages = function (group) {\n//\n// };\n\n\n\n\n\treturn db;\n}]);\n","angular.module('dc.db', ['firebase'])\n\n.factory('db', ['$rootScope', '$q', '$firebase', function($rootScope, $q, $firebase) {\n\tvar fb = new Firebase(\"https://dinner-collective.firebaseio.com/\");\n\tvar db = {};\n\n\t/**\n\t * Sign up a user\n\t * @param  {Object} credentials  - { firstname, lastname, email, password, passwordCheck }\n\t * @return {Q} - userDdata on success, error on failure\n\t */\n\tdb.signup = function(credentials) {\n\t\tvar d = $q.defer();\n\t\tfb.createUser(credentials, function(error) {\n\t\t\tif (error === null) {\n\t\t\t\tfb.authWithPassword(credentials, function(error, auth) {\n\t\t\t\t\tif (error === null) {\n\t\t\t\t\t\tvar user = fb.child('user').child(auth.uid),\n\t\t\t\t\t\tuserData = {\n\t\t\t\t\t\t\tuid: auth.uid, \n\t\t\t\t\t\t\tfirstname: credentials.firstname, \n\t\t\t\t\t\t\tlastname: credentials.lastname, \n\t\t\t\t\t\t\temail: credentials.email\n\t\t\t\t\t\t};\n\t\t\t\t\t\tuser.set(userData, function(error) {\n\t\t\t\t\t\t\tif (error === null) d.resolve(userData);\n\t\t\t\t\t\t\telse d.reject(error);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else d.reject(error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse d.reject(error);\n\t\t});\n\t\treturn d.promise;\n\t};\n\n\t/**\n\t * Log in a user\n\t * @param  {Object} credentials - { firstname, lastname, email, password, passwordCheck }\n\t * @return {Q} - userData on success, error on failure\n\t */\n\tdb.login = function(credentials) {\n\t\tvar d = $q.defer();\n\t\tfb.authWithPassword(credentials, function(error, auth) {\n\t\t\tif (error === null) d.resolve(auth.uid);\n\t\t\telse d.reject(error);\n\t\t});\n\t\treturn d.promise.then(db.getUserData);\n\t};\n\n\t/**\n\t * Log out the user\n\t */\n\tdb.logout = function() {\n\t\tfb.onAuth(function onAuth(auth) {\n\t\t \tif (auth === null) {\n\t\t \t\tconsole.log('user un-authenticated');\n\t\t \t\tfb.offAuth(onAuth);\n\t\t \t}\n\t\t});\n\t\tfb.unauth();\n\t\tdelete $rootScope.user;\n\t};\n\n\t/**\n\t * Synchronously get current authentication session\n\t * @return {String} - uid on success, null if not authenticated\n\t */\n\tdb.currentSession = function() {\n\t\tvar auth = fb.getAuth();\n\t\t// console.log('auth:', auth);\n\t\tif (auth != null) return auth.uid;\n\t\telse return null;\n\t};\n\n\t/**\n\t * Get user data\n\t * @param  {string} uid - unique user id\n\t * @return {Q} - userData on success, error on failure\n\t */\n\tdb.getUserData = function(uid) {\n\t\tvar d = $q.defer();\n\t\tvar user = fb.child('user').child(uid);\n\t\tuser.once('value', function(data) {\n\t\t\td.resolve(data.val());\n\t\t}, function(error) {\n\t\t\td.reject(error);\n\t\t});\n\t\treturn d.promise;\n\t};\n\n\tdb.getUserSync = function(userId) {\n\t\tvar user = fb.child('user').child(userId);\n\t\treturn $firebase(user).$asObject();\n\t};\n\n\n\tdb.updateUserData = function(userData) {\n\t\tvar user = fb.child('user').child(userData.uid);\n\t\tvar d = $q.defer();\n\t\tuser.update(userData, function onComplete(error) {\n\t\t\tif (error === null) d.resolve();\n\t\t\telse d.reject(error);\n\t\t});\n\t\treturn d.promise;\n\t};\n\n\n\tdb.newDinner = function(dinner) {\n\t\tvar dinners = fb.child('dinner');\n\t\tvar d = $q.defer();\n\t\tdinners.push(dinner, function onComplete(error) {\n\t\t\tif (error === null) d.resolve();\n\t\t\telse d.reject(error);\n\t\t});\n\t\treturn d.promise;\n\t};\n\n\n\t// db.getDinners = function(cb) {\n\t// \tvar dinners = fb.child('dinner');\n\t// \tvar d = $q.defer();\n\t// \tdinners.on('value', function(data) {\n\t// \t\tif (cb) cb( data.val() );\n\t// \t\tif (d) {\n\t// \t\t\td.resolve( data.val() );\n\t// \t\t\tdelete d;\n\t// \t\t}\n\t// \t});\n\t// \treturn d.promise;\n\t// };\n\n\tdb.getDinnersSync = function() {\n\t\tvar dinners = fb.child('dinner');\n\t\tvar sync = $firebase(dinners).$asArray();\n\t\treturn sync;\n\t};\n\n\n\tdb.getDinnerSync = function(dinnerId) {\n\t\tvar dinner = fb.child('dinner').child(dinnerId);\n\t\tvar sync = $firebase(dinner).$asObject();\n\t\t// TODO: proper security. only get user name\n\t\tsync.$loaded(function() {\n\t\t\tsync.userData = $firebase(fb.child('user').child(sync.user)).$asObject();\n\t\t});\t\n\t\treturn sync;\n\t};\n\n\t// db.getUserName = function(userId) {\n\t// \tvar firstname = fb.child('dinner').child(dinnerId)\n\t// };\n\t// \n\t\n\tdb.getUserDinners = function(userId) {\n\t\tvar dinners = fb.child('dinner').orderByChild('user').startAt(userId).endAt(userId);\n\t\tvar d = $q.defer();\n\t\t\tdinners.once('value', function(data) {\n\t\t\td.resolve(data.val());\n\t\t}, function(error) {\n\t\t\td.reject(error);\n\t\t});\n\t\treturn d.promise;\n\t};\n\n\n\tdb.newApplication = function(application) {\n\t\tvar applications = fb.child('application');\n\t\tvar d = $q.defer();\n\t\tapplication.state = 'applied';\n\t\tapplications.push(application, function onComplete(error) {\n\t\t\tif (error === null) d.resolve(application);\n\t\t\telse d.reject(error);\n\t\t});\n\t\treturn d.promise;\n\t};\n\n\n\tdb.getUserApplicationsSync = function(userId) {\n\t\tvar applications = fb.child('application').orderByChild('userId').startAt(userId).endAt(userId);\n\t\tvar sync = $firebase(applications).$asObject();\n\t\treturn sync;\n\t};\n\n\n\tdb.getDinnerApplicationsSync = function(dinnerId) {\n\t\tvar applications = fb.child('application').orderByChild('dinnerId').startAt(dinnerId).endAt(dinnerId);\n\t\tvar sync = $firebase(applications).$asArray();\n\t\t// load user data\n\t\tsync.$loaded(function() {\n\t\t\tangular.forEach(sync, function(application) {\n\t\t\t\tapplication.user = db.getUserSync(application.userId);\n\t\t\t});\n\t\t});\n\t\treturn sync;\n\t};\n\n\tdb.updateApplicationState = function(aId, state) {\n\t\tvar a = fb.child('application').child(aId);\n\t\tvar sync = $firebase(a).$asObject();\n\t\treturn sync.$loaded(function() {\n\t\t\tsync.state = state;\n\t\t\tsync.$save();\n\t\t});\n\t};\n\n\treturn db;\n}]);","angular.module('dc.directives', [])\n\n.directive('map', function() {\n   return {\n      restrict: 'E',\n      scope: {\n         onCreate: '&'\n      },\n      link: function($scope, $element, $attr) {\n         function initialize() {\n            var mapOptions = {\n               center: new google.maps.LatLng(48.2085, 16.373),\n               zoom: 16,\n               mapTypeId: google.maps.MapTypeId.ROADMAP,\n               streetViewControl: false\n            };\n            var map = new google.maps.Map($element[0], mapOptions);\n\n            $scope.onCreate({\n               map: map\n            });\n\n            // Stop the side bar from dragging when mousedown/tapdown on the map\n            google.maps.event.addDomListener($element[0], 'mousedown', function(e) {\n               e.preventDefault();\n               return false;\n            });\n         }\n\n         if (document.readyState === \"complete\") {\n            initialize();\n         } else {\n            google.maps.event.addDomListener(window, 'load', initialize);\n         }\n      }\n   }\n})\n\n// whenever the given expression is truthy show animated pending dots appended to the element\n.directive('pendingDots', function() {\n   return {\n      restrict: 'EA',\n      link: function(scope, element, attr) {\n         var dot = '.',\n         className = 'pending-dots',\n         showClassName = 'show-pending-dots',\n         html = '<span class=\"' + className + '\"><span class=\"dot-1\">' + dot + '</span><span class=\"dot-2\">' + dot + '</span><span class=\"dot-3\">' + dot + '</span></span>';\n         element.append(html);\n         scope.$watch(attr.pendingDots, function(newVal) {\n            if (newVal) element.addClass(showClassName);\n            else element.removeClass(showClassName);\n         })\n      }\n   };\n});\n","var f = angular.module('dc.filters', []);\n\n/* Compute the begin time of a dinner. */\nf.filter('getBeginTime', function() {\n\treturn function(dinner) {\n\t\tvar time;\n\t\tif (dinner.dinein && dinner.dinein.enabled) time = dinner.dinein.time;\n\t\telse if (dinner.takeaway && dinner.takeaway.enabled) time = dinner.takeaway.from;\n\t\treturn time;\n\t};\n});","var s = angular.module('dc.services', []);\n\n/**\n * A simple example service that returns some data.\n */\ns.factory('Friends', function() {\n\t// Might use a resource here that returns a JSON array\n\n\t// Some fake testing data\n\tvar friends = [\n\t\t{ id: 0, name: 'Scruff McGruff' },\n\t\t{ id: 1, name: 'G.I. Joe' },\n\t\t{ id: 2, name: 'Miss Frizzle' },\n\t\t{ id: 3, name: 'Ash Ketchum' }\n\t];\n\n\treturn {\n\t\tall: function() {\n\t\t\treturn friends;\n\t\t},\n\t\tget: function(friendId) {\n\t\t\t// Simple index lookup\n\t\t\treturn friends[friendId];\n\t\t}\n\t}\n});\n\ns.factory('resumeSession', function($rootScope, db, $q, $state) {\n\treturn function($scope) {\n\t\treturn db.auth.getCurrentSession()\n\t\t.then(function onFulfilled (userId) {\n\t\t\tif ($rootScope.user && $rootScope.user.uid === userId) {\n\t\t\t\t// no need to refetch user data\n\t\t\t\t$scope.user = $rootScope.user;\n\t\t\t\treturn $scope.user;\n\t\t\t} else {\n\t\t\t\tconsole.log('resuming session for user', userId);\n\t\t\t\t// fetch user data\n\t\t\t\tdb.user.get(userId).then(function(user) {\n\t\t\t\t\tconsole.log('resume successful', user);\n\t\t\t\t\t$rootScope.user = user;\n\t\t\t\t\t$scope.user = user;\n\t\t\t\t\treturn user;\n\t\t\t\t});\n\t\t\t}\n\t\t}).catch(function onRejected (error) {\n\t\t\t$state.go('app.login');\n\t\t});\n\t};\n});\n\ns.factory('util', function() {\n\treturn {\n\t\tnow: function(offsetMins) {\n\t\t\toffsetMins = offsetMins || 0;\n\t\t\tvar n = new Date();\n\t\t\tvar d = new Date( n.getTime() - n.getTimezoneOffset()*60000 + offsetMins*60000 );\n\t\t\t//return (d.toISOString()).substring(0,16); // text representation\n\t\t\treturn d;\n\t\t}\n\t};\n});\n\ns.factory('login', function($rootScope, db, $state) {\n\treturn function(user) {\n\t\tconsole.log(\"logging in\", user);\n\n\t\treturn db.auth.login(user).then(function(userId) {\n\t\t\tconsole.log(\"getting user\", userId);\n\t\t\tdb.user.get(userId).then(function (user) {\n\t\t\t\tconsole.log(\"login successful\", user);\n\t\t\t\t$rootScope.user = user;\n\t\t\t\t$state.go('app.settings');\n\t\t\t});\n\t\t}, function(error) {\n\t\t\tconsole.error('error logging in', error);\n\t\t\tthrow error;\n\t\t});\n\t};\n});\n\ns.factory('logout', function($rootScope, db, $state) {\n\treturn function() {\n\t\tconsole.log(\"logging out\");\n\t\t$rootScope.user = {}; // immediately remove user from scope\n\t\tdb.auth.logout().then(function() {\n\t\t\tconsole.log('logout sucessful');\n\t\t}, function (error) {\n\t\t\tconsole.error('error logging out', error);\n\t\t});\n\t\t$state.go('login'); // immediately go to login page\n\t};\n});\n\n// ping pending state of a promise to a variable $scope.name\ns.factory('bindPending', function() {\n\treturn function(promise, $scope, name) {\n\t\tif (!name) name = 'pending';\n\t\t// console.log(name);\n\n\t\tfunction done () {\n\t\t\tconsole.log('resetting isBusy');\n\t\t\t$scope[name] = false;\n\t\t}\n\t\tconsole.log('setting isBusy');\n\t\t$scope[name] = true;\n\n\t\treturn promise.then(function onResolve (value) {\n\t\t\tdone();\n\t\t\treturn value;\n\t\t}, function onReject (error) {\n\t\t\tdone();\n\t\t\tthrow error;\n\t\t});\n\t};\n});\n"],"sourceRoot":"/source/"}